
############################ 
#PURPOSE:
#INPUT: 
#OUTPUT: 
#DEVELOPED: 
#CONTACT: LacherI@si.edu
#NOTES:

#IMPORTANT: 
##### NEXT STEPS #####

############################

# SET WORKING DIRECTORY
# setwd("Y:/Lacher/...") #Harvard CLUSTER

# PACKAGES NEEDED

# rasters
library(raster)

# SET TEMP DIRECTORY
rasterOptions(tmpdir = "Y:/Lacher/rtempCLEARME/")

# ----------------------------------------------
################################################

# ----------------------------------------------
# ----------------------------------------------
# READ FILES: 
# ----------------------------------------------
# ----------------------------------------------


# ----------------------------------------------
# FILE LOCATIONS: 
# ----------------------------------------------


BR_fileLoc<-"Y:/Lacher/IaraSpatialLayers_HF/PreparedRasters/ProLands/BlueRidge/"
Output_Folder <- "Y:/Lacher/ProtectedLandsProject/PatchesTransitions_BR/Patch_Stats/"
Comb_output <- "Y:/Lacher/ProtectedLandsProject/PatchesTransitions_BR/Combine/Tables/" 
CombRas_output <- "Y:/Lacher/ProtectedLandsProject/PatchesTransitions_BR/Combine/Rasters/"


# ----------------------------------------------
# RAW RASTERS:
# ----------------------------------------------
# Format of original raw rasters is: 
# > pl_year
# class       : RasterLayer 
# dimensions  : 5821, 4930, 28697530  (nrow, ncol, ncell)
# resolution  : 180, 180  (x, y)
# extent      : 819105, 1706505, 1077045, 2124825  (xmin, xmax, ymin, ymax)
# coord. ref. : +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=23 +lon_0=-96 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0 
# data source : Y:\Lacher\IaraSpatialLayers_HF\PreparedRasters\ProLands\BlueRidge\pl_year.tif 
# names       : pl_year 
# values      : 1800, 9999  (min, max)


# Protected Lands yes/no '0', '1'
prot_yn <- 	raster(paste0(BR_fileLoc, "prot_yn.tif" )) 

# Protected Lands by YEAR 
pl_year <- 	raster(paste0(BR_fileLoc, "pl_year.tif" )) # nodata, years, 9999
# pl_yr_z <- raster(paste0(BR_fileLoc, "pl_yr_z.tif" )) # 0, years, 9999 # Raster reclassified so background =zero. This is at 360*360 resolution

# Unique Patch ID raster- patches distinguished by YEAR
yrly_patID<- raster(paste0(BR_fileLoc, "brPLiyrRSM.tif", sep=""))
	
pl_gap 	<- 	raster(paste0(BR_fileLoc, "pl_gap.tif"  ))
pl_own 	<- 	raster(paste0(BR_fileLoc, "pl_own.tif"  ))
pl_pp   <-	raster(paste0(BR_fileLoc, "pl_pp.tif"   ))
pl_type <- 	raster(paste0(BR_fileLoc, "pl_type.tif" ))

pl_nlcd <- 	raster(paste0(BR_fileLoc, "pl_nlcd.tif" ))
pl_er 	<- 	raster(paste0(BR_fileLoc, "pl_er.tif"   ))
pl_state <- raster(paste0(BR_fileLoc, "pl_state.tif"))
pl_resil <- raster(paste0(BR_fileLoc, "pl_resil.tif" ))
# pl_biopri <- raster(paste0(BR_fileLoc, "pl_biopri.tif")) # maybe come back to see note above


# ----------------------------------------------
# GENERATED RASTERS
# ----------------------------------------------


# Time Increment Raster
pl_85<-raster(paste0(BR_fileLoc, "pl_85.tif"))
pl_95<-raster(paste0(BR_fileLoc, "pl_95.tif"))
pl_05<-raster(paste0(BR_fileLoc, "pl_05.tif"))
pl_15<-raster(paste0(BR_fileLoc, "pl_15.tif"))

# Change Raster
pl_8595<-raster(paste0(CombRas_output, "pl_Comb8595.tif"))
pl_9505<-raster(paste0(CombRas_output, "pl_Comb9505.tif"))
pl_0515<-raster(paste0(CombRas_output, "pl_Comb0515.tif"))

# Patch ID Raster
plID_8595<-raster(paste0(CombRas_output, "pl_Comb8595patID.tif"))
plID_9505<-raster(paste0(CombRas_output, "pl_Comb9505patID.tif"))
plID_0515<-raster(paste0(CombRas_output, "pl_Comb0515patID.tif"))

# Adjacent Raster
adj8595_raster<-raster(paste0(CombRas_output, "adj_8595.tif"))
adj9505_raster<-raster(paste0(CombRas_output, "adj_9505.tif"))
adj0515_raster<-raster(paste0(CombRas_output, "adj_0515.tif"))

 
# ----------------------------------------------
# TABLES
# ----------------------------------------------

est_yr<-read.table(paste0(Output_Folder,"est_yr.txt"), sep=",", header=TRUE)

# > str(est_yr)
# 'data.frame':	14595 obs. of  2 variables:
 # $ patchID: int  1 2 3 4 5 6 7 8 9 10 ...
 # $ estYr  : int  1800 1800 1800 1800 1800 1800 1819 1819 1819 1819 ...
 
iStats_all<-read.csv("Y:/Lacher/ProtectedLandsProject/PatchesTransitions_BR/Patch_Stats/iStats_all.csv")

 # str(iStats_all)
# 'data.frame':	14595 obs. of  15 variables:
 # $ patchID          : int  1 2 3 4 5 6 7 8 9 10 ...
 # $ n.cell           : int  151 1 7 1 1 1 1 1 5 4 ...
 # $ n.core.cell      : int  61 0 0 0 0 0 0 0 0 0 ...
 # $ n.edges.perimeter: int  116 4 22 4 4 4 4 4 16 16 ...
 # $ n.edges.internal : int  488 0 6 0 0 0 0 0 4 0 ...
 # $ area             : num  4892400 32400 226800 32400 32400 ...
 # $ core.area        : int  1976400 0 0 0 0 0 0 0 0 0 ...
 # $ perimeter        : int  20880 720 3960 720 720 720 720 720 2880 2880 ...
 # $ perim.area.ratio : num  0.00427 0.02222 0.01746 0.02222 0.02222 ...
 # $ shape.index      : num  2.32 1 1.83 1 1 ...
 # $ frac.dim.index   : num  1.11 1 1.12 1 1 ...
 # $ core.area.index  : num  0.404 0 0 0 0 ...
 # $ Transition       : int  1800 1800 1800 1800 1800 1800 1800 1800 1800 1800 ...
 # $ Type             : Factor w/ 2 levels "noMeas","Separated": 1 1 1 1 1 1 1 1 1 1 ...
 # $ estYr            : int  1800 1800 1800 1800 1800 1800 1819 1819 1819 1819 ...

 iStats_corepat<-read.csv("Y:/Lacher/ProtectedLandsProject/PatchesTransitions_BR/Patch_Stats/iStats_corepat.csv")

# str(iStats_corepat)
# 'data.frame':	4121 obs. of  17 variables:
 # $ patchID          : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ n.cell           : int  151 19 57 272 48 365 349 190 21 503 ...
 # $ n.core.cell      : int  61 1 15 8 4 109 96 3 2 75 ...
 # $ n.edges.perimeter: int  116 32 52 418 64 282 328 368 26 628 ...
 # $ n.edges.internal : int  488 44 176 670 128 1178 1068 392 58 1384 ...
 # $ area             : num  4892400 615600 1846800 8812800 1555200 ...
 # $ core.area        : int  1976400 32400 486000 259200 129600 3531600 3110400 97200 64800 2430000 ...
 # $ perimeter        : int  20880 5760 9360 75240 11520 50760 59040 66240 4680 113040 ...
 # $ perim.area.ratio : num  0.00427 0.00936 0.00507 0.00854 0.00741 ...
 # $ shape.index      : num  2.32 1.78 1.62 6.33 2.29 ...
 # $ frac.dim.index   : num  1.11 1.09 1.08 1.23 1.12 ...
 # $ core.area.index  : num  0.404 0.0526 0.2632 0.0294 0.0833 ...
 # $ Transition       : int  1800 1800 1800 1800 1800 1800 1800 1800 1800 1800 ...
 # $ Type             : Factor w/ 2 levels "noMeas","Separated": 1 1 1 1 1 1 1 1 1 1 ...
 # $ estYr            : int  1800 1819 1819 1819 1819 1819 1819 1819 1819 1819 ...
 # $ area.ha          : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ core.area.ha     : num  197.64 3.24 48.6 25.92 12.96 ...
 
 

maj_categ<-read.table(paste0(Output_Folder,"maj_categ.txt"), sep=",", header=TRUE)

# str(maj_categ)
# 'data.frame':	4121 obs. of  19 variables:
 # $ patchID  : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ pp_maj   : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ pp_ha    : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ pp_prop  : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ gap_maj  : int  3 3 3 3 3 3 3 3 3 3 ...
 # $ gap_ha   : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ gap_prop : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ type_maj : int  2 2 2 2 2 2 2 2 2 2 ...
 # $ type_ha  : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ type_prop: num  100 100 100 100 100 100 100 100 100 100 ...
 # $ er_maj   : int  1 9 9 9 9 9 9 3 3 9 ...
 # $ er_ha    : num  469.8 61.6 184.7 881.3 155.5 ...
 # $ er_prop  : num  96 100 100 100 100 ...
 # $ own_maj  : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ own_ha   : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ own_prop : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ nlcd_maj : int  5 1 1 1 1 1 1 1 1 1 ...
 # $ nlcd_ha  : num  486 51.8 184.7 816.5 132.8 ...
 # $ nlcd_prop: num  99.3 84.2 100 92.6 85.4 ...

 
iStats_majJoin<-read.table(paste0(Output_Folder,"iStats_majJoin",".txt"), sep=",", header=TRUE)
# > str(iStats_majJoin)
# 'data.frame':	4121 obs. of  35 variables:
 # $ patchID          : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ n.cell           : int  151 19 57 272 48 365 349 190 21 503 ...
 # $ n.core.cell      : int  61 1 15 8 4 109 96 3 2 75 ...
 # $ n.edges.perimeter: int  116 32 52 418 64 282 328 368 26 628 ...
 # $ n.edges.internal : int  488 44 176 670 128 1178 1068 392 58 1384 ...
 # $ area             : num  4892400 615600 1846800 8812800 1555200 ...
 # $ core.area        : int  1976400 32400 486000 259200 129600 3531600 3110400 97200 64800 2430000 ...
 # $ perimeter        : int  20880 5760 9360 75240 11520 50760 59040 66240 4680 113040 ...
 # $ perim.area.ratio : num  0.00427 0.00936 0.00507 0.00854 0.00741 ...
 # $ shape.index      : num  2.32 1.78 1.62 6.33 2.29 ...
 # $ frac.dim.index   : num  1.11 1.09 1.08 1.23 1.12 ...
 # $ core.area.index  : num  0.404 0.0526 0.2632 0.0294 0.0833 ...
 # $ Transition       : int  1800 1800 1800 1800 1800 1800 1800 1800 1800 1800 ...
 # $ Type             : Factor w/ 3 levels "Expanded","noMeas",..: 2 2 2 2 2 2 2 2 2 2 ...
 # $ estYr            : int  1800 1819 1819 1819 1819 1819 1819 1819 1819 1819 ...
 # $ area.ha          : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ core.area.ha     : num  197.64 3.24 48.6 25.92 12.96 ...
 # $ pp_maj           : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ pp_ha            : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ pp_prop          : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ gap_maj          : int  3 3 3 3 3 3 3 3 3 3 ...
 # $ gap_ha           : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ gap_prop         : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ type_maj         : int  2 2 2 2 2 2 2 2 2 2 ...
 # $ type_ha          : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ type_prop        : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ er_maj           : int  1 9 9 9 9 9 9 3 3 9 ...
 # $ er_ha            : num  469.8 61.6 184.7 881.3 155.5 ...
 # $ er_prop          : num  96 100 100 100 100 ...
 # $ own_maj          : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ own_ha           : num  489.2 61.6 184.7 881.3 155.5 ...
 # $ own_prop         : num  100 100 100 100 100 100 100 100 100 100 ...
 # $ nlcd_maj         : int  5 1 1 1 1 1 1 1 1 1 ...
 # $ nlcd_ha          : num  486 51.8 184.7 816.5 132.8 ...
 # $ nlcd_prop        : num  99.3 84.2 100 92.6 85.4 ...
 
 
gap_area<-read.table(paste0(Output_Folder,"gap_area",".txt"), sep=",", header=TRUE)

own_area<-read.table(paste0(Output_Folder,"own_area",".txt"), sep=",", header=TRUE)

nlcd_area<-read.table(paste0(Output_Folder,"nlcd_area",".txt"), sep=",", header=TRUE)

resil_area<-read.table(paste0(Output_Folder,"resil_area",".txt"), sep=",", header=TRUE)

# > str(gap_area); str(own_area); str(nlcd_area); str(resil_area)
# 'data.frame':	16484 obs. of  4 variables:
 # $ patchID    : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ gap_count  : int  0 0 0 0 0 0 0 0 0 0 ...
 # $ gap_area_ha: num  0 0 0 0 0 0 0 0 0 0 ...
 # $ gap_Class  : int  2 2 2 2 2 2 2 2 2 2 ...
# 'data.frame':	16484 obs. of  4 variables:
 # $ patchID    : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ own_count  : int  151 19 57 272 48 365 349 190 21 503 ...
 # $ own_area_ha: num  489.2 61.6 184.7 881.3 155.5 ...
 # $ own_Class  : int  1 1 1 1 1 1 1 1 1 1 ...
# 'data.frame':	32968 obs. of  4 variables:
 # $ patchID     : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ nlcd_count  : int  0 16 57 252 41 356 336 174 21 488 ...
 # $ nlcd_area_ha: num  0 51.8 184.7 816.5 132.8 ...
 # $ nlcd_Class  : int  1 1 1 1 1 1 1 1 1 1 ...
# 'data.frame':	32968 obs. of  4 variables:
 # $ patchID      : int  1 11 17 49 64 69 97 120 145 158 ...
 # $ resil_count  : int  13 0 2 15 0 1 6 9 2 7 ...
 # $ resil_area_ha: num  42.12 0 6.48 48.6 0 ...
 # $ resil_Class  : int  1 1 1 1 1 1 1 1 1 1 ...

 
 
GapOwnNlRe_ar_join<-read.table(paste0(Output_Folder,"GapOwnNlRe_ar_join",".txt"), sep=",", header=TRUE)

# 'data.frame':	131872 obs. of  15 variables:
 # $ patchID      : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ estYr        : int  1800 1800 1800 1800 1800 1800 1800 1800 1800 1800 ...
 # $ er_maj       : int  1 1 1 1 1 1 1 1 1 1 ...
 # $ gap_count    : int  0 0 0 0 0 0 0 0 0 0 ...
 # $ gap_area_ha  : num  0 0 0 0 0 0 0 0 0 0 ...
 # $ gap_Class    : int  2 2 2 2 2 2 2 2 1 1 ...
 # $ own_count    : int  151 151 151 151 151 151 151 151 0 0 ...
 # $ own_area_ha  : num  489 489 489 489 489 ...
 # $ own_Class    : int  1 1 1 1 1 1 1 1 2 2 ...
 # $ nlcd_count   : int  0 1 0 150 0 0 0 0 0 1 ...
 # $ nlcd_area_ha : num  0 3.24 0 486 0 0 0 0 0 3.24 ...
 # $ nlcd_Class   : int  1 2 7 5 4 6 3 8 1 2 ...
 # $ resil_count  : int  13 0 138 0 0 0 0 0 13 0 ...
 # $ resil_area_ha: num  42.1 0 447.1 0 0 ...
 # $ resil_Class  : int  1 2 3 5 6 7 8 4 1 2 ...
 
 
# pat_dist_min<-read.table(paste0(Output_Folder,"pat_dist_min.txt"), sep=",", header=TRUE)

 
# ----------------------------------------------
# ----------------------------------------------
# RESULTS
# ----------------------------------------------
# ----------------------------------------------


# ----------------------------------------------
# CUMULATIVE AREA
# ----------------------------------------------

cum_TArER<-read.table(paste0(Output_Folder,"cum_TArER.txt"), sep=",", header=TRUE)
cum_ArOwn123<-read.table(paste0(Output_Folder,"cum_ArOwn123.txt"), sep=",", header=TRUE)
cum_NL123<-read.table(paste0(Output_Folder,"cum_NL123.txt"), sep=",", header=TRUE)
cum_GAP123<-read.table(paste0(Output_Folder,"cum_GAP123.txt"), sep=",", header=TRUE)

# Edited for 
cum_TArER_EDIT    <-read.table(paste0(Output_Folder,"cum_TArER_EDIT.txt"), sep="\t", header=TRUE)
cum_ArOwn123_EDIT <-read.table(paste0(Output_Folder,"cum_ArOwn123_EDIT.txt"), sep="\t", header=TRUE)
cum_NL123_EDIT    <-read.table(paste0(Output_Folder,"cum_NL123_EDIT.txt"), sep="\t", header=TRUE)
cum_GAP123_EDIT   <-read.table(paste0(Output_Folder,"cum_GAP123_EDIT.txt"), sep="\t", header=TRUE)




# ----------------------------------------------
# COALESCED CORE AREA 
# ----------------------------------------------


coal_vals1111 <- raster(paste0(BR_fileLoc, "coal_vals1111.tif", sep=""))
coal_vals8595 <- raster(paste0(BR_fileLoc, "coal_vals8595.tif", sep=""))
coal_vals9505 <- raster(paste0(BR_fileLoc, "coal_vals9505.tif", sep=""))
coal_vals0515 <- raster(paste0(BR_fileLoc, "coal_vals0515.tif", sep=""))

# ----------------------------------------------
# Nearest Neighbot Regression Outputs - Version 12-15-16
# ----------------------------------------------

# NN prediction
NNpred123<-read.table(paste0(Output_Folder,"NNpred123.txt"), sep=",", header=TRUE)


> summary(nnB); summary(nnP)

Call:
glm(formula = sqrt(min_dist.km) ~ estYr, data = dist_n1)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0534  -0.7075  -0.2304   0.5754   3.4236  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)   
(Intercept) 37.202374  13.430689   2.770  0.00588 **
estYr       -0.018202   0.006705  -2.715  0.00693 **
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.7057707)

    Null deviance: 275.51  on 384  degrees of freedom
Residual deviance: 270.31  on 383  degrees of freedom
AIC: 962.42

Number of Fisher Scoring iterations: 2


Call:
glm(formula = sqrt(min_dist.km) ~ estYr, data = dist_n23)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.0796  -0.7910  -0.1411   0.5091   3.4071  

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept) 27.116821   7.842051   3.458 0.000564 ***
estYr       -0.013117   0.003914  -3.351 0.000831 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for gaussian family taken to be 0.7909091)

    Null deviance: 915.26  on 1147  degrees of freedom
Residual deviance: 906.38  on 1146  degrees of freedom
AIC: 2992.6

Number of Fisher Scoring iterations: 2

